version: v1.0
name: Initial Pipeline with maven
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Basic tests
    task:
      jobs:
        - name: Run tests
          commands:
            - checkout
            - docker pull elgalu/selenium
            - docker pull dosel/zalenium
            - docker run -d --name zalenium -p 4444:4444 -e NEW_SESSION_WAIT_TIMEOUT=1800000 -e PULL_SELENIUM_IMAGE=true -v /var/run/docker.sock:/var/run/docker.sock -v /tmp/videos:/home/seluser/videos --privileged dosel/zalenium start
            - mvn clean install -DsuiteXmlFile=testng.xml
      epilogue:
        always:
          commands:
            - test-results publish target/surefire-reports/junitreports/TEST-org.lambdatest.SeleniumTest.xml
